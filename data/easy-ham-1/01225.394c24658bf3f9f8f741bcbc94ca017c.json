{"id":"01225","group":"easy-ham-1","checksum":{"type":"MD5","value":"394c24658bf3f9f8f741bcbc94ca017c"},"text":"From rpm-list-admin@freshrpms.net  Wed Oct  2 21:15:48 2002\nReturn-Path: <rpm-zzzlist-admin@freshrpms.net>\nDelivered-To: yyyy@localhost.spamassassin.taint.org\nReceived: from localhost (jalapeno [127.0.0.1])\n\tby jmason.org (Postfix) with ESMTP id C19D816F16\n\tfor <jm@localhost>; Wed,  2 Oct 2002 21:15:46 +0100 (IST)\nReceived: from jalapeno [127.0.0.1]\n\tby localhost with IMAP (fetchmail-5.9.0)\n\tfor jm@localhost (single-drop); Wed, 02 Oct 2002 21:15:46 +0100 (IST)\nReceived: from egwn.net (ns2.egwn.net [193.172.5.4]) by\n    dogma.slashnull.org (8.11.6/8.11.6) with ESMTP id g92JeNK24434 for\n    <jm-rpm@jmason.org>; Wed, 2 Oct 2002 20:40:23 +0100\nReceived: from auth02.nl.egwn.net (localhost [127.0.0.1]) by egwn.net\n    (8.11.6/8.11.6/EGWN) with ESMTP id g92Jc0f24595; Wed, 2 Oct 2002 21:38:00\n    +0200\nReceived: from taz.localdomain (adsl-66-124-59-34.dsl.anhm01.pacbell.net\n    [66.124.59.34]) by egwn.net (8.11.6/8.11.6/EGWN) with ESMTP id\n    g92Jbkf24533 for <rpm-list@freshrpms.net>; Wed, 2 Oct 2002 21:37:46 +0200\nReceived: by taz.localdomain (Postfix, from userid 500) id BBD8189D0;\n    Wed,  2 Oct 2002 12:36:02 -0700 (PDT)\nFrom: Gary Peck <gbpeck@sbcglobal.net>\nTo: rpm-zzzlist@freshrpms.net\nSubject: Re: alsa-driver.spec tweak for homemade kernels\nMessage-Id: <20021002193602.GC6266@taz.home.priv>\nMail-Followup-To: Gary Peck <gbpeck@sbcglobal.net>,\n\trpm-list@freshrpms.net\nReferences: <3D9AA650.2000909@eecs.berkeley.edu>\n    <20021002100919.2e3168a8.matthias@rpmforge.net>\nMIME-Version: 1.0\nContent-Type: multipart/mixed; boundary=\"RnlQjJ0d97Da+TV1\"\nContent-Disposition: inline\nIn-Reply-To: <20021002100919.2e3168a8.matthias@rpmforge.net>\nUser-Agent: Mutt/1.4i\nX-Mailscanner: Found to be clean, Found to be clean\nSender: rpm-zzzlist-admin@freshrpms.net\nErrors-To: rpm-zzzlist-admin@freshrpms.net\nX-Beenthere: rpm-zzzlist@freshrpms.net\nX-Mailman-Version: 2.0.11\nPrecedence: bulk\nReply-To: rpm-zzzlist@freshrpms.net\nList-Help: <mailto:rpm-zzzlist-request@freshrpms.net?subject=help>\nList-Post: <mailto:rpm-zzzlist@freshrpms.net>\nList-Subscribe: <http://lists.freshrpms.net/mailman/listinfo/rpm-zzzlist>,\n    <mailto:rpm-list-request@freshrpms.net?subject=subscribe>\nList-Id: Freshrpms RPM discussion list <rpm-zzzlist.freshrpms.net>\nList-Unsubscribe: <http://lists.freshrpms.net/mailman/listinfo/rpm-zzzlist>,\n    <mailto:rpm-list-request@freshrpms.net?subject=unsubscribe>\nList-Archive: <http://lists.freshrpms.net/pipermail/rpm-zzzlist/>\nX-Original-Date: Wed, 2 Oct 2002 12:36:02 -0700\nDate: Wed, 2 Oct 2002 12:36:02 -0700\n\n\n--RnlQjJ0d97Da+TV1\nContent-Type: text/plain; charset=us-ascii\nContent-Disposition: inline\n\nOn Wed, Oct 02, 2002 at 10:09:19AM +0200, Matthias Saou wrote:\n> Well, I don't really find it consistent at all to use an rpm package built\n> against something that wasn't installed through rpm :-/\n\nFollowing that reasoning, I've been installing all my custom-built\nkernels through rpm recently. I find it annoying, though, that \nalsa-kernel, and similar packages, will only build for the currently \nrunning kernel.\n\nSo I've attached a patch to specify an alternate kernel by setting the\n\"TARGET_KERNEL\" environment variable before running rpmbuild. You\nstill need to have the rpm for the specified kernel installed, but at\nleast it doesn't have to be currently running. It's kinda hackish, so\nif someone has a better way to do this, let me know.\n\ngary\n\n--RnlQjJ0d97Da+TV1\nContent-Type: text/plain; charset=us-ascii\nContent-Disposition: inline; filename=\"alsa-driver-spec.patch\"\n\n--- alsa-driver.spec.orig\t2002-10-02 12:25:26.000000000 -0700\n+++ alsa-driver.spec\t2002-10-01 21:23:19.000000000 -0700\n@@ -3,9 +3,12 @@\n # Comma separated list of cards for which to compile a driver\n %define\tcards\t\tall\n \n-%define\tkunamer\t\t%(uname -r)\n-%define\tkversion\t%(echo $(uname -r) | sed -e s/smp// -)\n-%if %(uname -r | grep -c smp)\n+%if %(printenv TARGET_KERNEL >/dev/null && echo -n 1 || echo -n 0)\n+%define usekernel\t%(echo -n $TARGET_KERNEL)\n+%endif\n+%define\tkunamer\t\t%{!?usekernel: %(uname -r)}%{?usekernel}\n+%define\tkversion\t%(echo %{kunamer} | sed -e s/smp// -)\n+%if %(echo %{kunamer} | grep -c smp)\n \t%{expand:%%define ksmp -smp}\n %endif\n %define\tkarch\t\t%(rpm -q --qf '%%{arch}' kernel%{?ksmp}-%{kversion})\n@@ -77,6 +80,7 @@\n \t%{?_without_isapnp:--with-isapnp=no} \\\n \t%{?_without_sequencer:--with-sequencer=no} \\\n \t%{?_without_oss:--with-oss=no} \\\n+\t%{?usekernel:--with-kernel=/lib/modules/%{usekernel}/build} \\\n \t--with-cards=%{cards}\n make\n \n@@ -106,10 +109,10 @@\n rm -f %{buildroot}/etc/rc.d/init.d/alsasound\n \n %post -n alsa-kernel%{?ksmp}\n-/sbin/depmod -a\n+/sbin/depmod -a -F /boot/System.map-%{kunamer} %{kunamer}\n \n %postun -n alsa-kernel%{?ksmp}\n-/sbin/depmod -a\n+/sbin/depmod -a -F /boot/System.map-%{kunamer} %{kunamer}\n \n %clean\n rm -rf %{buildroot}\n\n--RnlQjJ0d97Da+TV1--\n\n_______________________________________________\nRPM-List mailing list <RPM-List@freshrpms.net>\nhttp://lists.freshrpms.net/mailman/listinfo/rpm-list\n\n\n"}