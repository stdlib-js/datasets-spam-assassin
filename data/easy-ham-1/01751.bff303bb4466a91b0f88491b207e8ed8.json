{"id":"01751","group":"easy-ham-1","checksum":{"type":"MD5","value":"bff303bb4466a91b0f88491b207e8ed8"},"text":"Return-Path: neale@woozle.org\nDelivery-Date: Wed Sep 11 06:14:36 2002\nFrom: neale@woozle.org (Neale Pickett)\nDate: 10 Sep 2002 22:14:36 -0700\nSubject: [Spambayes] stack.pop() ate my multipart message\nMessage-ID: <w53lm6985vn.fsf@woozle.org>\n\nI've been running hammie on all my incoming messages, and I noticed that\nmultipart/alternative messages are totally hosed: they have no content,\njust the MIME boundaries.  For instance, the following message:\n\n------------------------------8<------------------------------\nFrom: somebody <someone@somewhere.org>\nTo: neale@woozle.org\nSubject: Booga\nContent-type: multipart/alternative; boundary=\"snot\"\n\nThis is a multi-part message in MIME format.\n\n--snot\nContent-type: text/plain; charset=iso-8859-1\nContent-transfer-encoding: 7BIT\n\nHi there.\n--snot\nContent-type: text/html; charset=iso-8859-1\nContent-transfer-encoding: 7BIT\n\n<pre>Hi there.</pre>\n--snot--\n------------------------------8<------------------------------\n\nComes out like this:\n\n------------------------------8<------------------------------\nFrom: somebody <someone@somewhere.org>\nTo: neale@woozle.org\nSubject: Booga\nContent-type: multipart/alternative; boundary=\"snot\"\nX-Hammie-Disposition: No; 0.74; [unrelated gar removed]\n\nThis is a multi-part message in MIME format.\n\n--snot\n\n--snot--\n------------------------------8<------------------------------\n\nI'm using \"Python 2.3a0 (#1, Sep  9 2002, 22:56:24)\".\n\nI've fixed it with the following patch to Tim's tokenizer, but I have to\nadmit that I'm baffled as to why it works.  Maybe there's some subtle\ninteraction between generators and lists that I can't understand.  Or\nsomething.  Being as I'm baffled, I don't imagine any theory I come up\nwith will be anywhere close to reality.\n\nIn any case, be advised that (at least for me) hammie will eat\nmultipart/alternative messages until this patch is applied.  The patch\nseems rather bogus though, so I'm not checking it in, in the hope that\nthere's a better fix I just wasn't capable of discovering :)\n\n------------------------------8<------------------------------\nIndex: tokenizer.py\n===================================================================\nRCS file: /cvsroot/spambayes/spambayes/tokenizer.py,v\nretrieving revision 1.15\ndiff -u -r1.15 tokenizer.py\n--- tokenizer.py\t10 Sep 2002 18:15:49 -0000\t1.15\n+++ tokenizer.py\t11 Sep 2002 05:01:16 -0000\n@@ -1,3 +1,4 @@\n+#! /usr/bin/env python\n \"\"\"Module to tokenize email messages for spam filtering.\"\"\"\n \n import email\n@@ -507,7 +508,8 @@\n             htmlpart = textpart = None\n             stack = part.get_payload()\n             while stack:\n-                subpart = stack.pop()\n+                subpart = stack[0]\n+                stack = stack[1:]\n                 ctype = subpart.get_content_type()\n                 if ctype == 'text/plain':\n                     textpart = subpart\n------------------------------8<------------------------------\n\n\n"}