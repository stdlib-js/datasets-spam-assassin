{"id":"00161","group":"hard-ham-1","checksum":{"type":"MD5","value":"786d4f37f37d9043eb4fc2d3521b78b4"},"text":"Received: from timhunt.net (ns1.timhunt.net [216.27.147.130])\n\tby dogma.slashnull.org (8.11.6/8.11.6) with ESMTP id g6Q6r1430476\n\tfor <tim_timhunt_net@spamtraps.taint.org>; Fri, 26 Jul 2002 07:53:02 +0100\nReceived: from minardi.isc.org (minardi.isc.org [204.152.189.14])\n\tby timhunt.net (8.11.3/8.11.1) with ESMTP id g6Q6qGE47635\n\tfor <ibarra@fsg.com>; Fri, 26 Jul 2002 02:52:17 -0400 (EDT)\n\t(envelope-from firewalls-bounce@isc.org)\nReceived: from rc.isc.org (rc.isc.org [204.152.187.2])\n\tby minardi.isc.org (Postfix) with ESMTP\n\tid 2FA153D7C; Thu, 25 Jul 2002 23:51:42 -0700 (PDT)\n\t(envelope-from firewalls-bounce@isc.org)\nReceived: with ECARTIS (v1.0.0; list firewalls); Thu, 25 Jul 2002 23:51:00 -0700 (PDT)\nDate: Thu, 25 Jul 2002 23:51:00 -0700 (PDT)\nFrom: ISC Mailing List Manager <ecartis@isc.org>\nTo: firewalls digest users <ecartis@isc.org>\nSubject: firewalls Digest V1 #33\nPrecedence: bulk\nMessage-Id: <20020726065142.2FA153D7C@minardi.isc.org>\n\nfirewalls Digest\tThu, 25 Jul 2002\tVolume: 01  Issue: 033\n\nIn This Issue:\n\t\tRe: QOS\n\t\tFW: disable some sites\n\t\tDNAT with iptables question\n\t\tRE: DNAT with iptables question\n\n----------------------------------------------------------------------\n\nFrom: \"George J. Jahchan\" <Firewalls@Tech.InteractiveNetworks.net>\nSubject: Re: QOS\nDate: Thu, 25 Jul 2002 12:11:40 +0300\n\n\n> So, I'm forced to conclude that the PacketShaper either sucks in a major\n> way, or that your explanation/the explanation that you have been given of\n> it is wrong. (Sorry.)\n\nYou are wrong on both counts. Explanation is valid for symmetrical TCP, for\nothers see explanations below.\n\n> Yes, all packets in an established TCP connection have the ACK flag set.\n> So all packets except SYNs are candidates for delay when traffic limits\n> are exceeded? Whoops.\n\nYou should change that to: ... are always candidates for predictive or\npreventive delay.\n\nACKs are delayed (per flow) in such a way that WAN-bound traffic reaching\nthe edge router's Ethernet interface does not exceed WAN link speed (NO\nROUTER QUEUES!). It does not wait for the link to be at or near saturation\nto act -- that is why, unlike queueing, it is predictive and not reactive.\n\nIt slows down the rate of transmission of sending hosts (on a per-flow\nbasis) to accommodate WAN link speed limit and current network utilization,\nrather than fill up queues at LAN speeds and empty them at WAN speeds,\neventually dropping the excess once the queue(s) fill up, informing hosts to\nslow down their rate of transmission once queues are beyond a fixed\nthreshold (90%?).\n\nRate control works equally well for outbound and inbound traffic. Ever heard\nof an effective queueing technology for inbound traffic? Queueing packets\nafter they have crossed a congested link does not make much sense, does it?\n\nRe: IPsec/GRE or other encapsulated traffic\n\nIt obviously cannot dissect IPsec/GRE or other encapsulated traffic: it sees\nthe tunnel as one connection if the tunneling device is before the PS on the\nLAN side (VPN gateway and router are two separate devices, PS between them).\nIf the router does the tunneling, then the PS sees clear traffic. Typically,\nin an organization the first scenario would be the case at headquarters and\nthe second at branch offices. The PS at the branch sees traffic inside the\ntunnel whereas the unit at HQ sees all traffic as one tunnel which allows\nfull management of both tunneled and clear traffic at both ends.\n\nUDP and asymmetrical TCP (where the PS and router only see the outgoing\npacket, return traffic coming back through a satellite downlink to a station\non the LAN) are handled differently.\n\nFor asymmetrical TCP, it will time the release of packets to the receiving\ndevice, thereby indirectly timing the release of acknowledgements by the\nreceiving host. This informs the sender's TCP/IP stack that it should slow\nthe release of packets because limited bandwidth is available.\n\nFor UDP, it utilizes flow-based derivative random drop. It selectively drops\nonly one packet at a time from flows that are predicted to cause congestion,\nwhich prevents heavy retransmissions and application timeouts.\n\nICMP packets exceeding policy limits are dropped.\n\n>_Maybe_ you can do a special case for TCP and try to offload some of the\nqueueing on\n> the endpoints, but I really don't see the real gain in that.\n\nThe real gain is manageability and control. A LAN host only knows about the\nstate of its own connections and is oblivious to WAN conditions until its\nTCP/IP stack learns (when router queues are nearly full) that the WAN is\ncongested. A PS will predict and inform the LAN hosts' TCP/IP stacks of the\n\"speed limit to obey\" for every connection (based on policies and network\nconditions), avoiding congestion. Control for asymmetrical TCP and UDP may\nnot be as \"tight\" as for symmetrical TCP, but it does work.\n\nQueueing is akin to deploying cops only when traffic jams occur, vs. rate\ncontrol where cops are permanently deployed throughout town, communicating\nwith each other and with a central control point, predicting upcoming\ncongestion and regulating traffic, ensuring a smooth flow of traffic. If\nthere is potential for congestion, it will take a driver a hell of lot\nlonger to cross town with first approach than it will with the second. Do\nyou agree?\n\n----- Original Message -----\nFrom: \"Mikael Olsson\" <mikael.olsson@clavister.com>\nTo: \"George J. Jahchan\" <Firewalls@Tech.InteractiveNetworks.net>\nCc: \"Firewalls List\" <Firewalls@ISC.org>\nSent: Wednesday, July 24, 2002 4:50 pm\nSubject: Re: QOS\n\n\n\n\n\"George J. Jahchan\" wrote:\n>\n> The whole purpose of the device is to pro-actively prevent WAN\ncongestion --\n> it sits between client and server (client inside/server outside or client\n> outside/server inside -- it does not make any difference) and pro-actively\n> adjusts the TCP window size (by delaying the acknowledgement) to get the\n> sending host to honor the speed limit for that individual connection\n> (calculated in real-time based on user-defined policies and current\nnetwork\n> conditions).\n\nUmm, don't get me wrong here, but I think you've been fed a less-than-\naccurate sales pitch.\n\nLet's ponder this for a minute.\n\nThe device works by delaying ACKs... that is: packets with the ACK\nflag set, right?\n\n...\n\n[letting this sink in for a while]\n\n...\n\nYes, all packets in an established TCP connection have the ACK flag set.\nSo all packets except SYNs are candidates for delay when traffic limits\nare exceeded? Whoops.\n\n\nOkay, let's assume for a second that the packets aren't actually delayed,\nbut that the ACK sequence numbers or TCP window size fields are re-written\n(dicey). All you've accomplished is move the queueing (delaying) from\nthe traffic shaper to the endpoints. You still get L7-to-L7 delays. Big\ndeal if it happens on the wire or in the stack. Also, convincing endpoints\nto do delays probably results in less-than-perfect shaping since stack\nretransmit timings suddenly affect the actual bandwidth available rather\nthan having the shaper itself do it; the shaper knows exactly when there\nis bandwidth available.\n\nBut this doesn't even begin to touch on other protocols like UDP or\nICMP. Or, for that matter, IPsec/GRE/whatever tunneled traffic.\nNeither of them have sequence numbers or window sizes that you can\nmanipulate.\n\n\nSo, I'm forced to conclude that the PacketShaper either sucks in a major\nway, or that your explanation/the explanation that you have been given of\nit is wrong. (Sorry.)\n\nWhat I think happens is that the delay is <=2msec as long as traffic\nlimits aren't exceeded. This is reasonable. BUT when traffic exceeds\nthe limits, things will begin to be queued. Now, with a well-behaved\nTCP stack, this _will_ mean that it will fall back to lower transmission\nrates; this is how TCP was designed, so that part isn't all wrong.\n\nAnd, again, this kind of shaping isn't rocket science. That is not to\nsay that there are shapers out there that are just being plain dumb\n(always queueing and the selecting what gets transmitted out of the\nqueue), but, well, I just can't see that you can get any smarter\nthan queueing when limits are actually exceeded.  _Maybe_ you can do\na special case for TCP and try to offload some of the queueing on the\nendpoints, but I really don't see the real gain in that.\n\n\nRespectfully,\n/Mikael Olsson\n\n--\nMikael Olsson, Clavister AB\nStorgatan 12, Box 393, SE-891 28 �RNSK�LDSVIK, Sweden\nPhone: +46 (0)660 29 92 00   Mobile: +46 (0)70 26 222 05\nFax: +46 (0)660 122 50       WWW: http://www.clavister.com\n\n\"It's July. I'm on vacation. Can't you tell? :)\"\n--\nFirewalls mailing list - [ firewalls@isc.org ]\nTo unsubscribe: http://www.isc.org/services/public/lists/firewalls.html\n\n\n\n------------------------------\n\nFrom: \"Hiemstra, Brenno\" <brenno.hiemstra@ignite.nl>\nSubject: FW: disable some sites\nDate: Thu, 25 Jul 2002 13:44:18 +0200\n\n\nThe list addy changed ofcourse   :o)\n\n> -----Original Message-----\n> From:\tHiemstra, Brenno \n> Sent:\tdonderdag 25 juli 2002 12:27\n> To:\t'Michael Zhao'; Hiemstra, Brenno\n> Cc:\tfirewalls@lists.gnac.net\n> Subject:\tRE: disable some sites\n> \n> Michael,\n> \n> If I was in your shoes I would first investigate if there\n> is a security policy in your organisation. If you dont know\n> what I mean by a security policy I would advice you to \n> start reading about it. A search on google would be of a\n> big help for you.\n> \n> If there is a security policy I would read it and investigate\n> what is tells about how employees are able to use their\n> workstations for performing their function. In a security \n> policy there should be things what employees are allowed\n> to do on the network / internet and what not.\n> \n> If there isnt a security policy I would advice you to implement\n> one in your company. Because without one you cant punish\n> employees by violating the policy and if there is a court case\n> you dont have any rock solid thing to smack around with.\n> \n> Without a policy you are just implementing solutions to prevent\n> employees in doing things that, im my opinion, they arent allowed\n> to do on their workstations anyway. I dont like the idea that \n> employees play games, use kazaa, ICQ, MSN, etc etc in stead\n> of working what we pay them to do. This is why a security policy\n> is important because then you can say to employees that they\n> violated it and that there are consequences for that (deny internet\n> access, etc etc).\n> \n> Owkee...    now that this is out of the way time to proceed about\n> the proxy thingie.\n> \n> A proxy dont have to be the default gateway of your network to\n> use it. It is a function in Internet Explorer or whatever browser you\n> use in your network.\n> \n> If you ask me Checkpoint Firewalls are just good in using for what\n> their real purpose is and that is firewalling a network. I dont like the\n> idea that my firewall is also CVS http thingie because I dont think\n> a firewall is its purpose to do that. Proxies are a much better solutions\n> for that and they are also developed for that purpose.\n> \n> Depending on your network setup and the OS and Proxy brand of your\n> current proxy you have several solutions which was already provided \n> by people on this list. My favorite proxy is Squid and there are probably\n> a lot of http blacklist programs that work with Squid to block websites\n> and stuff.\n> \n> I still think you should first deny direct internet traffic from\n> workstations.\n> and only allow traffic to the internet from servers that are allowed to do\n> so. You should think about proxies, email servers, etc etc. This should\n> also prevent people from playing games, especially those Quake kinda\n> games because those use ports that arent necessary for normal \n> webbrowsing. Games running over port 80 and not http related are blocked\n> by the proxy if that proxy is a true Layer 7 application layer proxy.\n> These\n> kinda proxies can view in the TCP/IP packet and see if this is legitimate \n> http traffic or that someone tries to tunnel something over port 80.\n> \n> Anyway...    again food for some thoughts,\n> \n> Regards,\n> \n> \n> \n> Brenno\n> \n> \n> -----Original Message-----\n> From:\tMichael Zhao [SMTP:mzhao@everlastingsystems.com]\n> Sent:\twoensdag 24 juli 2002 2:38\n> To:\tHiemstra, Brenno\n> Cc:\tfirewalls@lists.gnac.net\n> Subject:\tRe: disable some sites\n> \n> Thanks your reply.\n> \n> I built up my network three years ago . I have proxy which we only use \n> cache to accelerate our internet accessing , it is not a gateway . It is \n> too difficult to change the topology , many thing need to be changed.\n> \n> Did you have another idea to help me? Someone suggest me to buy the \n> websence , but I dont have the budget right now.\n> \n> Thanks a lot\n> \n> Michael\n> \n> Hiemstra, Brenno wrote:\n> \n> >Michael,\n> >\n> >The first thing is to build a security policy that\n> >states what people are allowed to do and what\n> >not. Everyone needs to accept this policy and \n> >if they violate it you can apply rules that you state\n> >in your security policy.\n> >\n> >If I had the option for your network setup I would\n> >install a proxy server and demand every client\n> >to connect to the proxy if they want to use the \n> >internet.\n> >\n> >The proxy will only allow http, ftp, and other \"approved\"\n> >services to connect to the internet. And you can let\n> >them check to some database which websites are\n> >allowed and deny access to sites that aren't allowed\n> >\n> >Your company firewall will only allow the proxy to connect\n> >to the internet. Clients are denied.\n> >\n> >This way the clients cant connect directly to the internet\n> >game servers and on the proxy you can deny clients\n> >to connect to the game servers.\n> >\n> >I hope this is an option for you.\n> >\n> >Regards,\n> >\n> >\n> >Brenno\n> >\n> >>-----Original Message-----\n> >>From:\tMichael Zhao [SMTP:mzhao@everlastingsystems.com]\n> >>Sent:\tdinsdag 23 juli 2002 14:10\n> >>To:\tfirewalls@lists.gnac.net\n> >>Subject:\tdisable some sites\n> >>\n> >>Hi , all\n> >>\n> >>I choose checkpoint fw-1 as my firewall . I found many company users \n> >>play internet games like CS, ourgame . I find users download their \n> >>clients software and install  on their local workstation , after run it \n> >>, the programe can connect to game server automatically .\n> >>\n> >>Usally , there are many sites of every internet game server. I.E. I want\n> \n> >>disable accessing the game servers like xxx.ourgame.com from my internal\n> \n> >>net , how can I do that except find all of their IP address , because it\n> \n> >>is so complecat to do . Who can tell me .\n> >>\n> >>Regards,\n> >>Michael\n> >>\n> >>-- \n> >>Firewalls mailing list - [ firewalls@isc.org ]\n> >>To unsubscribe: http://www.isc.org/services/public/lists/firewalls.html\n> >>\n> \n\n------------------------------\n\nDate: Thu, 25 Jul 2002 15:08:21 -0600\nFrom: Jerry Lynde <jlynde@diligence.com>\nSubject: DNAT with iptables question\n\n\nHowdy folks,\n\nI've been scouring the online docs for solid info on how to accomplish DNAT \nwith iptables.\n\nEssentially, I have converted the ipmasqadm lines of the form...\n\nipmasqadm portfw -a -P tcp -L $WEB_OUT  http    -R $WEB_IN      http\n\nto iptables lines of the form...\n\n$IPTABLES -A PREROUTING -t nat -p tcp -d $WEB_OUT --dport 80 -j DNAT --to \n$WEB_IN:80\n\nwith the accompanying lines...\n\n\n$IPTABLES -A FORWARD -i $INTIF -o $EXTIF -m state --state \nESTABLISHED,RELATED -j ACCEPT\n$IPTABLES -A FORWARD -i $EXTIF -o $INTIF -m state --state \nESTABLISHED,RELATED -j ACCEPT\n$IPTABLES -A FORWARD -i $EXTIF -o $INTIF -p tcp -j ACCEPT\n\nThe last two lines seem functionally sorta redundant, but I threw em in in \nan effort to make this work.\nSo far, I am unable to show that it's working correctly... I even tried \nlogging all packets...\n\n$IPTABLES -A FORWARD -i $INTIF -p tcp -j LOG --log-level info\n$IPTABLES -A FORWARD -i $EXTIF -p tcp -j LOG --log-level info\n\nBut nothing show up in /var/log/messages or anywhere else for that matter. \nThis is on a Redhat 7.3 box.\nAny help, clues, flames, RT(his particular)FM, etc are appreciated.\n\nI read the list, so please don't reply directly in addition to the list \nresposne.\n\n\nThanks,\n\nJer \n\n\n------------------------------\n\nFrom: \"Reckhard, Tobias\" <tobias.reckhard@secunet.com>\nSubject: RE: DNAT with iptables question\nDate: Fri, 26 Jul 2002 08:32:37 +0200\n\n\n> $IPTABLES -A PREROUTING -t nat -p tcp -d $WEB_OUT --dport 80 \n> -j DNAT --to \n> $WEB_IN:80\n> \n> with the accompanying lines...\n> \n> \n> $IPTABLES -A FORWARD -i $INTIF -o $EXTIF -m state --state \n> ESTABLISHED,RELATED -j ACCEPT\n> $IPTABLES -A FORWARD -i $EXTIF -o $INTIF -m state --state \n> ESTABLISHED,RELATED -j ACCEPT\n> $IPTABLES -A FORWARD -i $EXTIF -o $INTIF -p tcp -j ACCEPT\n> \n> The last two lines seem functionally sorta redundant, but I \n> threw em in in \n> an effort to make this work.\n\nYou're missing the NEW state. The initial SYN packet will not match with\neither of the first two rules. It should match the third if it's inbound,\nthough.\n\n> So far, I am unable to show that it's working correctly... I \n> even tried \n> logging all packets...\n> \n> $IPTABLES -A FORWARD -i $INTIF -p tcp -j LOG --log-level info\n> $IPTABLES -A FORWARD -i $EXTIF -p tcp -j LOG --log-level info\n> \n> But nothing show up in /var/log/messages or anywhere else for \n> that matter. \n\nYou need to insert those logging rules above any ACCEPT, REJECT or DENY\nrules for them to be of any use. Are you sure the packets are hitting the\nbox at all? Try moving the log rules to the top of the FORWARD chain,\nintroduce logging rules to the PREROUTING, POSTROUTING, INPUT and OUTPUT\nchains, and/or use tcpdump as well to see where the packets are travelling.\n\nCheers\nTobias\n\n------------------------------\n\nEnd of firewalls Digest V1 #33\n******************************\n\n\n"}